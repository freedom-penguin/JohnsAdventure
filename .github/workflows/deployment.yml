# TODO:
# - AppImage for GNU/Linux distributions
# - DiskImage for MacOS 
# - Regular Zip for Windows

name: Python application

on:    
  workflow_dispatch:

permissions:
  contents: read|write

jobs:
  gnu-linux:

    runs-on: ubuntu-22.04

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.11
      uses: actions/setup-python@v3
      with:
        python-version: "3.11"
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flake8 numpy pyinstaller
        pip install pygame --pre

    - name: Lint with flake8
      run: |
        # stop the build if there are Python syntax errors or undefined names
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
        
    - name: Build game 
      run: |
        pyinstaller build.spec
        chmod +x ./dist/*
        
    - name: Install Zip package
      uses: montudor/action-zip@v1.0.0
    
    - name: Start zipping 
      run: |
        zip $(uname).zip ./dist/*
    
    - name: Upload To Github Release
      uses: xresloader/upload-to-github-release@v1.3.9
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN }}
      with:
        # The files or file patterns to upload. You can upload multiple files by split them by semicolon. You can use the glob pattern to find the files.
        file: ./*.zip
        branches: main
        # With verbose: true, be verbose.
        verbose: true
        # Set custom tag name.
        tag_name: Game Release

